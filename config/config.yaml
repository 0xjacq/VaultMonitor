probes:
  - id: usd3_monitor
    type: evm_call
    enabled: true
    interval: 60000 # 60s
    rpcUrl: https://eth.drpc.org
    calls:
      - name: supplyCap
        target: "0x056B269Eb1f75477a8666ae8C7fE01b64dD55eCc"
        abi: ["function supplyCap() view returns (uint256)"]
        method: supplyCap
        decimals: 6
      
      - name: totalAssets
        target: "0x056B269Eb1f75477a8666ae8C7fE01b64dD55eCc"
        abi: ["function totalAssets() view returns (uint256)"]
        method: totalAssets
        decimals: 6

    rules:
      - id: cap_threshold_check
        type: threshold
        fact: supplyCap_formatted
        operator: ">"
        threshold: 50000000
        severity: warning
        title: "USD3 Cap Threshold Breached"
        messageTemplate: "Supply Cap is ${value} (Limit: ${threshold})"

      - id: assets_threshold_check
        type: threshold
        fact: totalAssets_formatted
        operator: ">"
        threshold: 50000000
        severity: warning
        title: "USD3 Assets Threshold Breached"
        messageTemplate: "Total Assets is ${value} (Limit: ${threshold})"
      
      - id: cap_change_check
        type: change
        fact: supplyCap_formatted
        severity: info
        title: "USD3 Supply Cap Changed"

  - id: pendle_monitor
    type: http
    enabled: true
    interval: 60000
    url: "https://api-v2.pendle.finance/core/v1/sdk/1/markets/0xeaac9b0b4f25cc63255198a3920fcf7752509586/swapping-prices"
    extract:
      impliedApy: impliedApy
    rules:
      - id: pendle_apy_check
        type: threshold
        fact: impliedApy
        operator: ">"
        threshold: 0.14
        severity: warning
        title: "Pendle APY Alert"
        messageTemplate: "Implied APY is ${value} (Threshold: ${threshold})"
